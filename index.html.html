<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>JAHRESzeugnisgenerator Klasse 5 bis 10</title>
<style>
body { font-family: Arial, sans-serif; margin: 0; }
h1 { text-align: center; margin: 20px 0 5px; }
h2 { text-align: center; font-size: 0.9em; font-weight: normal; color: #555; margin-bottom: 25px; }

.container { display: flex; justify-content: center; gap: 70px; padding: 20px; }
.left, .right { width: 35%; }

.block-header { font-weight: bold; font-size: 1.15em; cursor: pointer; margin-bottom: 6px; }
.block-content { border-left: 3px solid #ccc; padding-left: 12px; margin-bottom: 25px; }

select, input, button { width: 100%; padding: 6px; margin-bottom: 10px; }

.add-button { background-color: #4CAF50; color: white; border: none; cursor: pointer; }

#output { height: 330px; padding: 10px; border: 1px solid #aaa; background: #f9f9f9; }

.button-row { display: flex; gap: 10px; }
.copy-btn { background-color: #7EC8E3; color: white; border: none; }
.delete-btn { background-color: #E74C3C; color: white; border: none; }

/* pulsieren */
.pulse {
  animation: pulseAnim 0.25s ease-in-out;
}

@keyframes pulseAnim {
  0%   { transform: scale(1); }
  50%  { transform: scale(1.08); }
  100% { transform: scale(1); }
}

<meta charset="UTF-8">
<title>Zeugnisgenerator</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">

<!-- iOS PWA Support -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Zeugnisgenerator">
<link rel="apple-touch-icon" href="icon.png">

<!-- iOS SAFARI FIX -->
<meta name="viewport"
      content="width=device-width,
               initial-scale=1.0,
               maximum-scale=1.0,
               user-scalable=no">

               select {
                 -webkit-appearance: menulist;
                 appearance: menulist;
                 font-size: 16px; /* iOS Fix: verhindert Zoom */
               }

               block-content {
                 max-height: 0;
                 overflow: hidden;
                 transition: max-height 0.25s ease;
               }

               .block-content.active {
                 max-height: 2000px; /* gro√ü genug */
               }

</style>
</head>
<body>

  <div id="loginScreen" style="
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:white;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:9999;
  ">

  <h1>JAHRESzeugnisgenerator = Verben √ºberwiegend im Pr√§teritum</h1>

  <h2>
  created & engineered mostly by ChatGPT and ideas came from Mr Pre from RSNEC
  </h2>

  <div style="width:320px; margin-top:25px;">

  <input type="password"
  id="passwordInput"
  placeholder="Passwort eingeben"
  style="padding:10px; font-size:16px; width:100%;">

  <button onclick="login()"
  style="
  margin-top:10px;
  padding:10px;
  width:100%;
  background-color:#4CAF50;
  color:white;
  border:none;
  cursor:pointer;
  font-size:16px;">
  Login
  </button>

  <p id="loginError" style="color:red; text-align:center;"></p>

  </div>

  </div>

  <div id="mainApp" style="display:none;">

<h1>JAHRESzeugnisgenerator = Verben √ºberwiegend im Pr√§teritum</h1>
<h2>created & engineered mostly by ChatGPT and ideas came from Mr Pre from RSNEC</h2>

<div style="text-align:center; margin-bottom:25px;">
  <button id="resetAllBtn" onclick="pulseButton(this); confirmReset()"
    style="
      width:360px;
      height:90px;
      background-color:#8e44ad;
      color:white;
      font-weight:bold;
      font-size:1.1em;
      border:none;
      cursor:pointer;
    ">
    Neuer Sch√ºler
  </button>
</div>

<div class="container">
<div class="left">

<!-- ================= BLOCK 1 ================= -->
<div class="block-header" onclick="toggleBlock('b1','s1')"><span id="s1">‚àí</span> 1. Wesen und Aufmerksamkeit</div>
<div class="block-content" id="b1">
<label>Vorname:</label><input id="studentName">
<label>Geschlecht:</label>
<select id="gender">
  <option value="m">m√§nnlich</option>
  <option value="w">weiblich</option>
</select>
<label>Anzahl Adjektive:</label>
<select id="adjCount1" onchange="buildAdjBlock1()">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
</select>
<div id="adjBox1"></div>
<label>Aufmerksamkeit:</label>
<select id="attention">
  <option value="den Unterricht besuchte">den Unterricht besuchte</option>
  <option value="dem Unterricht beiwohnte">dem Unterricht beiwohnte</option>
  <option value="dem Unterricht folgte">dem Unterricht folgte</option>
  <option value="dem Unterricht aufmerksam folgte">dem Unterricht aufmerksam folgte</option>
  <option value="dem Unterricht immer aufmerksam folgte">dem Unterricht immer aufmerksam folgte</option>
  <option value="dem Unterricht meist aufmerksam folgte">dem Unterricht meist aufmerksam folgte</option>
  <option value="dem Unterricht nicht immer aufmerksam folgte">dem Unterricht nicht immer aufmerksam folgte</option>
  <option value="dem Unterricht konzentriert folgte">dem Unterricht konzentriert folgte</option>
  <option value="dem Unterricht immer konzentriert folgte">dem Unterricht immer konzentriert folgte</option>
  <option value="dem Unterricht meist konzentriert folgte">dem Unterricht meist konzentriert folgte</option>
  <option value="dem Unterricht nicht immer konzentriert folgte">dem Unterricht nicht immer konzentriert folgte</option>
</select>
<button class="add-button"
onclick="pulseButton(this); secureAction(gen1)">
Text hinzuf√ºgen
</button>


</div>

<!-- ================= BLOCK 2 ================= -->
<div class="block-header" onclick="toggleBlock('b2','s2')"><span id="s2">+</span> 2. Mitarbeit</div>
<div class="block-content" id="b2" style="display:none;">
<label>Beteiligung:</label>
<select id="mitForm">
  <option value="">keine Angabe</option>
  <option>beteiligte sich</option>
  <option>beteiligte sich aktiv</option>
  <option>beteiligte sich engagiert</option>
  <option>beteiligte sich interessiert</option>
  <option>beteiligte sich √ºberwiegend eigenaktiv</option>
  <option>beteiligte sich zur√ºckhaltend</option>
  <option>beteiligte sich eher zur√ºckhaltend</option>
  <option>beteiligte sich gelegentlich</option>
  <option>beteiligte sich nur punktuell</option>
  <option>beteiligte sich interessenbezogen</option>
  <option>beteiligte sich nur interessenbezogen</option>
  <option>beteiligte sich zu stark interessenbezogen</option>
  <option>beteiligte sich nur sporadisch</option>
  <option>beteiligte sich kaum</option>
  <option>beteiligte sich zu selten</option>
  <option>beteiligte sich nicht</option>
  <option>beteiligte sich nicht eigenaktiv</option>
  <option>beteiligte sich nur nach Aufforderung</option>
  <option>beteiligte sich widerwillig nur nach Aufforderung</option>
  <option>beteiligte sich widerwillig</option>
  <option>beteiligte sich auch nach Aufforderung nicht</option>
</select>
<label>Beitragsqualit√§t:</label>
<select id="mitQual">
  <option value="">keine Angabe</option>
  <option>passende Beitr√§ge</option>
  <option>angemessene Beitr√§ge</option>
  <option>eigene L√∂sungsans√§tze</option>
  <option>durchdachte Beitr√§ge</option>
  <option>wohl durchdachte Beitr√§ge</option>
  <option>weiterf√ºhrende Gedanken</option>
  <option>hilfreiche Beitr√§ge</option>
  <option>konstruktive Beitr√§ge</option>
  <option>einfache Beitr√§ge</option>
  <option>eigene Beitr√§ge</option>
  <option>Beitr√§ge</option>
</select>
<label>Eigeninitiative?</label>
<select id="mitEigen">
  <option value="">keine Angabe</option>
  <option>Hierbei w√§re zuk√ºnftig mehr Eigeninitiative w√ºnschenswert</option>
</select>
<button class="add-button"
onclick="pulseButton(this); secureAction(gen2)">
Text hinzuf√ºgen
</button>


</div>

<!-- ================= BLOCK 3 ================= -->
<div class="block-header" onclick="toggleBlock('b3','s3')">
  <span id="s3">+</span> 3. Arbeitsverhalten
</div>

<div class="block-content" id="b3" style="display:none;">

<label>H√§ufigkeit:</label>
<select id="freq3">
  <option value="">keine Angabe</option>
  <option>stets</option>
  <option>immer</option>
  <option>meist</option>
  <option>h√§ufig</option>
  <option>oftmals</option>
  <option>regelm√§√üig</option>
  <option>gelegentlich</option>
  <option>selten</option>
  <option>kaum</option>
  <option>nie</option>
</select>

<label>Anzahl Merkmale:</label>
<select id="nounCount3" onchange="buildNounBlock3()">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
</select>

<div id="nounBox3"></div>

<button class="add-button"
onclick="pulseButton(this); secureAction(gen3)">
Text hinzuf√ºgen
</button>

</div>

<!-- ================= BLOCK 4 ================= -->
<div class="block-header" onclick="toggleBlock('b4','s4')">
  <span id="s4">+</span> 4. Hausaufgaben
</div>

<div class="block-content" id="b4" style="display:none;">

<label>Anzahl Merkmale:</label>
<select id="nounCount4" onchange="buildNounBlock4()">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
</select>

<div id="nounBox4"></div>

<button class="add-button"
onclick="pulseButton(this); secureAction(gen4)">
Text hinzuf√ºgen
</button>

</div>

<!-- ================= BLOCK 5 ================= -->
<div class="block-header" onclick="toggleBlock('b5','s5')">
  <span id="s5">+</span> 5. Gruppenarbeit
</div>

<div class="block-content" id="b5" style="display:none;">

  <label>Anzahl Gr√ºnde:</label>
  <select id="groupCount" onchange="buildGroupReasons()">
    <option value="0">0</option>
    <option value="1">1</option>
    <option value="2">2</option>
  </select>

  <div id="groupBox"></div>

  <div style="margin-top:15px;"></div>

  <label>Bewertungsstufe:</label>
  <select id="groupLevel">
    <option value="anerkannt">anerkannt</option>
    <option value="gesch√§tzt">gesch√§tzt</option>
    <option value="sehr gesch√§tzt">sehr gesch√§tzt</option>
    <option value="besonders gesch√§tzt">besonders gesch√§tzt</option>
    <option value="in hohem Ma√üe gesch√§tzt">in hohem Ma√üe gesch√§tzt</option>
    <option value="au√üerordentlich gesch√§tzt">au√üerordentlich gesch√§tzt</option>
    <option value="gesch√§tzt und anerkannt">gesch√§tzt und anerkannt</option>
    <option value="insgesamt gesch√§tzt">insgesamt gesch√§tzt</option>
    <option value="√ºberwiegend gesch√§tzt">√ºberwiegend gesch√§tzt</option>
    <option value="meist gesch√§tzt">meist gesch√§tzt</option>
    <option value="im Allgemeinen gesch√§tzt">im Allgemeinen gesch√§tzt</option>
    <option value="zunehmend gesch√§tzt">zunehmend gesch√§tzt</option>
    <option value="teilweise gesch√§tzt">teilweise gesch√§tzt</option>
    <option value="gesch√§tzt und anerkannt, wenngleich er/sie sich nicht aktiv einbrachte">gesch√§tzt und anerkannt, wenngleich er/sie sich nicht aktiv einbrachte</option>
    <option value="gesch√§tzt und anerkannt, wenngleich er/sie sich nicht immer aktiv einbrachte">gesch√§tzt und anerkannt, wenngleich er/sie sich nicht immer aktiv einbrachte</option>
    <option value="gesch√§tzt, zeigte jedoch gelegentlich Zur√ºckhaltung">gesch√§tzt, zeigte jedoch gelegentlich Zur√ºckhaltung</option>
    <option value="gesch√§tzt, zeigte jedoch gelegentlich wenig Motivation">gesch√§tzt, zeigte jedoch gelegentlich wenig Motivation</option>

    </select>

<div id="groupBox"></div>

<button class="add-button"
onclick="pulseButton(this); secureAction(gen5)">
Text hinzuf√ºgen
</button>

</div>

<!-- ================= BLOCK 6 ================= -->
<div class="block-header" onclick="toggleBlock('b6','s6')"><span id="s6">+</span> 6. Verhalten</div>
<div class="block-content" id="b6" style="display:none;">
<label>Verhalten:</label>
<select id="behavior">
  <option value="">keine Auswahl</option>
  <option>vorbildlich</option>
  <option>stets vorbildlich</option>
  <option>lobenswert</option>
  <option>stets lobenswert</option>
  <option>angemessen</option>
  <option>meist angemessen</option>
  <option>nicht immer angemessen</option>
  <option>anerkennenswert</option>
  <option>sehr anerkennenswert</option>
  <option>zufriedenstellend</option>
  <option>ordentlich</option>
  <option>nicht tadelfrei</option>
</select>
<button class="add-button"
onclick="pulseButton(this); secureAction(gen6)">
Text hinzuf√ºgen
</button>


</div>

</div>

<div class="right">
<div id="output"></div>
<div class="button-row">
  <button class="copy-btn" onclick="pulseButton(this); copyText()">Text kopieren</button>
  <button class="delete-btn" onclick="pulseButton(this); clearText()">Textfeld L√∂schen</button>
  <div class="button-row" style="margin-top:10px;">
  <button id="undoBtn"
    onclick="pulseButton(this); undoLast()"
    style="background-color:#000002; color:white; border:none; cursor:pointer;"
    disabled>
    Letzte Eingabe r√ºckg√§ngig
  </button>
</div>
  <button id="replaceBtn" onclick="pulseButton(this); markAndReplace()" style="background-color: orange; color: white;">Wortwiederholung 'UND' pr√ºfen</button>

</div>
</div>

</div>

<script>

/* undo */
let textHistory = [];

function undoLast(){
  const out = document.getElementById("output");
  if(textHistory.length === 0) return;

  out.innerText = textHistory.pop();
  updateUndoButton();
}

function updateUndoButton(){
  const btn = document.getElementById("undoBtn");
  if(!btn) return;
  btn.disabled = textHistory.length === 0;
  btn.style.opacity = btn.disabled ? "0.4" : "1";
}


/* ---------- TOGGLE ---------- */

function toggleBlock(id){
  document.querySelectorAll(".block-content").forEach(b=>{
    b.classList.remove("active");
  });
  document.getElementById(id).classList.add("active");
}

function toggleBlock(id,s){
  ["b1","b2","b3","b4","b5","b6"].forEach(b=>{
    const el=document.getElementById(b);
    if(el){el.style.display="none";}
    const sp=document.getElementById("s"+b.slice(1));
    if(sp){sp.textContent="+";}
  });
  document.getElementById(id).style.display="block";
  document.getElementById(s).textContent="‚àí";

  // üîπ NEU: Block 5 sofort initialisieren
  if(id === "b5"){
    buildGroupReasons();
  }
}

/* pulsieren */
function pulseButton(btn){
  btn.classList.remove("pulse"); // wichtig bei schnellem Klicken
  void btn.offsetWidth;          // reflow erzwingen
  btn.classList.add("pulse");
}

/* ---------- TEXT ---------- */
function addText(t){const out = document.getElementById("output");
  // aktuellen Zustand merken
  textHistory.push(out.innerText);
  // Text anh√§ngen (nur Leerzeichen, kein Absatz)
  out.innerText += (out.innerText ? " " : "") + t;
  updateUndoButton();
}
function copyText(){ navigator.clipboard.writeText(output.innerText); }
function clearText(){ output.innerText=""; }

/* undo platz richtig in cleartext??? */
textHistory = [];
updateUndoButton();

let markStep = 0; // 0 = noch nicht gedr√ºckt, 1 = markiert, 2 = korrigiert

function markAndReplace(){
    const outputEl = document.getElementById("output");
    if(markStep === 0){
        // Schritt 1: alle "und" markieren
        const regex = /\bund\b/g;
        outputEl.innerHTML = outputEl.innerText.replace(regex, '<span style="background-color: orange;">und</span>');
        document.getElementById("replaceBtn").innerText = "√Ñndere jedes 2. 'UND' in 'SOWIE'";
        markStep = 1;
    } else if(markStep === 1){
        // Schritt 2: jedes zweite "und" ersetzen
        let text = outputEl.innerText;
        let count = 0;
        text = text.replace(/\bund\b/g, function(match){
            count++;
            return (count % 2 === 0) ? "sowie" : match;
        });
        outputEl.innerText = text; // HTML-Tags entfernen
        // Button deaktivieren
        const btn = document.getElementById("replaceBtn");
        btn.disabled = true;
        btn.style.backgroundColor = "#ccc";
        btn.style.cursor = "not-allowed";
        markStep = 2;
    }
}


/* ---------- BLOCK 1 ---------- */
const adjBlock1List=["ausgeglichen","besonnen","diskussionsfreudig","ehrgeizig","flei√üig","freundlich","hilfsbereit","h√∂flich","leistungswillig","lebhaft","nett","ruhig","selbstbewusst","selbstst√§ndig","strebsam","vielseitig interessiert","zuvorkommend"];
function buildAdjBlock1(){
  adjBox1.innerHTML="";
  for(let i=0;i<+adjCount1.value;i++){
    const s=document.createElement("select");
    s.innerHTML="<option value=''>Adjektiv w√§hlen</option>";
    adjBlock1List.forEach(a=>s.innerHTML+=`<option>${a}</option>`);
    s.onchange=()=>disableAdj(adjBox1);
    adjBox1.appendChild(s);
  }
}
function gen1(){
  const n=studentName.value.trim();
  if(!n) return alert("Name fehlt");
  const g=gender.value;
  const art=g==="w"?"eine":"ein";
  const noun=g==="w"?"Sch√ºlerin":"Sch√ºler";
  const rel=g==="w"?"die":"der";
  const raw=[...adjBox1.querySelectorAll("select")].map(s=>s.value).filter(Boolean);
  const adj=raw.map(a=>g==="w"?a+"e":a+"er");
  let a="";
  if(adj.length===1)a=adj[0];
  if(adj.length===2)a=adj[0]+" sowie "+adj[1];
  if(adj.length===3)a=adj[0]+", "+adj[1]+" sowie "+adj[2];
  addText(`${n} ist ${art} ${a?a+" ":""}${noun}, ${rel} ${attention.value}.`);
}

/* ---------- BLOCK 2 ---------- */
function gen2(){

  const g = gender.value;
  const p = g==="w" ? "Sie" : "Er";

  let s = "";

  if(mitForm.value || mitQual.value){

    s = p + " " + mitForm.value;

    if(mitForm.value && mitQual.value) s += " und ";

    if(mitQual.value){
      s += "brachte " + mitQual.value + " ein";
    }

    s += ".";
  }

  if(mitEigen.value){
    s += " Hierbei w√§re zuk√ºnftig mehr Eigeninitiative w√ºnschenswert.";
  }

  if(s) addText(s);
}

/* ---------- BLOCK 3 & 4 ---------- */
/* ---------- ZENTRALE NOMENLISTE BLOCK 3 & 4 ---------- */
const workNouns = [
"Arbeitseinsatz",
"Ausdauer",
"Belastbarkeit",
"Effizienz",
"Initiative",
"Engagement",
"Genauigkeit",
"Gewissenhaftigkeit",
"Gr√ºndlichkeit",
"Konzentration",
"Leistungsbereitschaft",
"Motivation",
"√úberdurchschnittliche Leistungsbereitschaft",
"Ordentlichkeit",
"Planungsf√§higkeit",
"Pflichtbewusstsein",
"Sorgfalt",
"Selbstst√§ndigkeit",
"Strebsamkeit",
"Strukturiertheit",
"Systematik",
"Umsicht",
"Verantwortungsbewusstsein",
"Verl√§sslichkeit",
"Zielstrebigkeit",
"Zuverl√§ssigkeit"
];

/* =====================================================
   BLOCK 3 & BLOCK 4 ‚Äì NOMINALSTIL MIT SYNCHRONISIERUNG
===================================================== */

/* ---------- BUILD BLOCK 3 ---------- */
function buildNounBlock3(){

  const usedIn4 = [...nounBox4.querySelectorAll("select")]
                  .map(s=>s.value)
                  .filter(Boolean);

  nounBox3.innerHTML="";

  for(let i=0;i<+nounCount3.value;i++){

    const s=document.createElement("select");
    s.innerHTML="<option value=''>Merkmal w√§hlen</option>";

    workNouns.forEach(n=>{
      const disabled = usedIn4.includes(n) ? "disabled" : "";
      s.innerHTML+=`<option ${disabled}>${n}</option>`;
    });

    s.onchange=updateNounBlocks;
    nounBox3.appendChild(s);
  }
}

/* ---------- BUILD BLOCK 4 ---------- */
function buildNounBlock4(){

  const usedIn3 = [...nounBox3.querySelectorAll("select")]
                  .map(s=>s.value)
                  .filter(Boolean);

  nounBox4.innerHTML="";

  for(let i=0;i<+nounCount4.value;i++){

    const s=document.createElement("select");
    s.innerHTML="<option value=''>Merkmal w√§hlen</option>";

    workNouns.forEach(n=>{
      const disabled = usedIn3.includes(n) ? "disabled" : "";
      s.innerHTML+=`<option ${disabled}>${n}</option>`;
    });

    s.onchange=updateNounBlocks;
    nounBox4.appendChild(s);
  }
}

/* ---------- SYNCHRONISIERUNG ---------- */
function updateNounBlocks(){

  const chosen3 = [...nounBox3.querySelectorAll("select")]
                  .map(s=>s.value)
                  .filter(Boolean);

  const chosen4 = [...nounBox4.querySelectorAll("select")]
                  .map(s=>s.value)
                  .filter(Boolean);

  const allChosen = [...chosen3, ...chosen4];

  // Block 3 aktualisieren
  [...nounBox3.querySelectorAll("select")].forEach(select=>{
    [...select.options].forEach(opt=>{
      if(opt.value === "") return;

      opt.disabled = allChosen.includes(opt.value) && opt.value !== select.value;
    });
  });

  // Block 4 aktualisieren
  [...nounBox4.querySelectorAll("select")].forEach(select=>{
    [...select.options].forEach(opt=>{
      if(opt.value === "") return;

      opt.disabled = allChosen.includes(opt.value) && opt.value !== select.value;
    });
  });

}

/* ---------- GEN BLOCK 3 ---------- */
function gen3(){

  const g = gender.value;
  const rel = g==="w" ? "ihr" : "ihm";
  const adv = freq3.value;

  const raw = [...nounBox3.querySelectorAll("select")]
              .map(s=>s.value)
              .filter(Boolean);

  if(!raw.length) return;

  let merkmale = raw.length===2
      ? raw[0] + " und " + raw[1]
      : raw[0];

  let s = merkmale + " kennzeichneten ";

  if(adv){
    s += adv + " ";
  }

  s += `die Ausf√ºhrung der ${rel} gestellten Arbeitsauftr√§ge.`;

  addText(s);
}

/* ---------- GEN BLOCK 4 ---------- */
function gen4(){

  const n = studentName.value.trim();
  if(!n) return alert("Name fehlt");

  const raw = [...nounBox4.querySelectorAll("select")]
              .map(s=>s.value)
              .filter(Boolean);

  if(!raw.length) return;

  let merkmale = raw.length===2
      ? raw[0] + " und " + raw[1]
      : raw[0];

  addText(`Mit ${merkmale} erledigte ${n} die h√§usliche Unterrichtsvorbereitung.`);
}

function buildAdj(box,count,used=[]){
  box.innerHTML="";
  for(let i=0;i<+count.value;i++){
    const s=document.createElement("select");
    s.innerHTML="<option value=''>Adjektiv w√§hlen</option>";
    adjWork.forEach(a=>s.innerHTML+=`<option ${used.includes(a)?"disabled":""}>${a}</option>`);
    s.onchange=()=>disableAdj(box);
    box.appendChild(s);
  }
}
function disableAdj(box){
  const sels=[...box.querySelectorAll("select")];
  const chosen=sels.map(s=>s.value).filter(Boolean);
  sels.forEach(sel=>[...sel.options].forEach(o=>o.disabled=chosen.includes(o.value)&&o.value!==sel.value&&o.value));
}

/* ---------- BLOCK 5 ---------- */
const groupReasons=["offenen Art","aufgeschlossenen Art","kommunikativen Art","hilfsbereiten Art","freundlichen Art","ruhigen Art","ausgeglichenen Pers√∂nlichkeit","konzentrierten Arbeitsweise","zielstrebigen Arbeitsweise","strukturierten Arbeitsweise","verl√§sslichen Arbeitsweise","kommunikativen Arbeitsweise","konstruktiven Arbeitsweise","ausdauernden Arbeitsweise","pflichtbewussten Arbeitsweise","kreativen Arbeitsweise","F√§higkeit, andere Meinungen zu respektieren,","F√§higkeit, seine Meinung nachvollziehbar zu verteten,","F√§higkeit, Inhalte verst√§ndlich zu erkl√§ren,",];
function buildGroupReasons(){ groupBox.innerHTML=""; for(let i=0;i<+groupCount.value;i++){ const s=document.createElement("select"); s.innerHTML="<option value=''>Grund w√§hlen</option>"; groupReasons.forEach(r=>s.innerHTML+=`<option>${r}</option>`); s.onchange=()=>disableAdj(groupBox); groupBox.appendChild(s); } }
function gen5(){

  const g = document.getElementById("gender").value;
  const poss = g === "w" ? "ihrer" : "seiner";
  const pron = g === "w" ? "sie" : "er";

  const raw = [...groupBox.querySelectorAll("select")]
              .map(s => s.value)
              .filter(Boolean);

  if(!raw.length) return;

  const levelRaw = document.getElementById("groupLevel").value;

  // Platzhalter ersetzen
  const level = levelRaw.replace("er/sie", pron);

  let grund = "";

  if(raw.length === 1){
    grund = `${poss} ${raw[0]}`;
  }

  if(raw.length === 2){
    grund = `${poss} ${raw[0]} und der ${raw[1]}`;
  }

  addText(`Bei Gruppenarbeiten wurde ${pron} aufgrund ${grund} ${level}.`);
}


/* ---------- BLOCK 6 ---------- */
function gen6(){ const n=document.getElementById("studentName").value.trim(); if(!n) return alert("Name fehlt"); const g=document.getElementById("gender").value; const rel=g==="w"?"der Sch√ºlerin":"des Sch√ºlers"; const val=document.getElementById("behavior").value; if(!val) return; addText(`Das Verhalten ${rel} gegen√ºber Lehrkr√§ften und Mitsch√ºlern war ${val}.`);}


/* ---------- NEUER SCH√úLER BUTTON = ALLES ZUR√úCKSETZEN ---------- */
function resetAll(){

 //undo BTN reset
 textHistory = [];
updateUndoButton();


  // Name & Geschlecht
  document.getElementById("studentName").value = "";
  document.getElementById("gender").value = "m";

  // Alle Selects zur√ºcksetzen
  document.querySelectorAll("select").forEach(sel=>{
    sel.selectedIndex = 0;
  });

  // Textfeld leeren
  document.getElementById("output").innerText = "";

  // Alle Toggle-Bl√∂cke schlie√üen
  ["b1","b2","b3","b4","b5","b6"].forEach(b=>{
    const el = document.getElementById(b);
    if(el) el.style.display = "none";
    const sp = document.getElementById("s"+b.slice(1));
    if(sp) sp.textContent = "+";
  });

  // Wortwiederholungs-Button zur√ºcksetzen
  if(typeof markStep !== "undefined"){
    markStep = 0;
    const btn = document.getElementById("replaceBtn");
    if(btn){
      btn.disabled = false;
      btn.style.backgroundColor = "orange";
      btn.style.cursor = "pointer";
      btn.innerText = "Wortwiederholung pr√ºfen";
    }
  }

  // Block 1 wieder automatisch √∂ffnen (UX!)
  toggleBlock("b1","s1");
}
let resetStep = 0;

function confirmReset(){
  const btn = document.getElementById("resetAllBtn");

  if(resetStep === 0){
    // Schritt 1: Nachfrage
    btn.innerText = "SICHER?";
    btn.style.backgroundColor = "#c0392b"; // rot
    resetStep = 1;
  } else {
    // Schritt 2: wirklich zur√ºcksetzen
    resetAll();

    // Button zur√ºcksetzen
    btn.innerText = "Neuer Sch√ºler = Alle Eingaben l√∂schen";
    btn.style.backgroundColor = "#8e44ad"; // lila
    resetStep = 0;
  }
}

resetStep = 0;
const resetBtn = document.getElementById("resetAllBtn");
if(resetBtn){
  resetBtn.innerText = "Neuer Sch√ºler = Alle Eingaben l√∂schen";
  resetBtn.style.backgroundColor = "#8e44ad";
}



</script>

<script type="module">


// ZENTRALE SCHUTZFUNKTION
window.secureAction = async function(actionFunction){

  try{

    const snap =
      await getDoc(doc(db,"config","login"));

    const firebaseVersion =
      snap.data().version;

    const localVersion =
      localStorage.getItem("zeugnisVersion");

    if(firebaseVersion != localVersion){

      sessionStorage.removeItem("zeugnisLogin");

      alert("Neue Version verf√ºgbar. Bitte neu einloggen.");

      location.reload();

      return;

    }

    // Wichtig: hier wird die echte Funktion ausgef√ºhrt
    actionFunction();

  }
  catch(e){

    alert("Internetverbindung erforderlich.");

  }

}

// Schutzfuntkion Ende

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
getFirestore,
doc,
getDoc
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


const firebaseConfig = {
apiKey: "AIzaSyCuQCpuiCvAiQ9Qvlf6K1UG1HmA_-qd1e4",
authDomain: "redlinevokabeltrainernr1.firebaseapp.com",
projectId: "redlinevokabeltrainernr1",
storageBucket: "redlinevokabeltrainernr1.firebasestorage.app",
messagingSenderId: "505004267790",
appId: "1:505004267790:web:64847ac064ba993d369f5f"
};


const app = initializeApp(firebaseConfig);

const db = getFirestore(app);


// SHA256 Funktion
async function sha256(text){

const buffer =
await crypto.subtle.digest(
"SHA-256",
new TextEncoder().encode(text)
);

return Array.from(new Uint8Array(buffer))
.map(b => b.toString(16).padStart(2,"0"))
.join("");

}

let CURRENT_VERSION = null;


// Versionspr√ºfung
async function checkVersion(){

  const snap =
    await getDoc(doc(db,"config","login"));

  CURRENT_VERSION =
    snap.data().version;

  const savedVersion =
    localStorage.getItem("zeugnisVersion");

  if(savedVersion != CURRENT_VERSION){

    sessionStorage.removeItem("zeugnisLogin");

    localStorage.setItem(
      "zeugnisVersion",
      CURRENT_VERSION
    );

  }

}


// LOGIN
window.login = async function(){

  const input =
    document.getElementById("passwordInput").value;

  if(!input){

    document.getElementById("loginError").innerText =
      "Bitte Passwort eingeben";

    return;

  }

  const hash =
    await sha256(input);

  const snap =
    await getDoc(doc(db,"config","login"));

  const correctHash =
    snap.data().passwordHash;

  CURRENT_VERSION =
    snap.data().version;

  if(hash === correctHash){

    sessionStorage.setItem(
      "zeugnisLogin",
      "ok"
    );

    localStorage.setItem(
      "zeugnisVersion",
      CURRENT_VERSION
    );

    document.getElementById("loginScreen").style.display="none";

    document.getElementById("mainApp").style.display="block";

  }
  else{

    document.getElementById("loginError").innerText =
      "Falsches Passwort";

  }

};


// beim Start pr√ºfen
window.addEventListener("load", async ()=>{

  await checkVersion();

  if(sessionStorage.getItem("zeugnisLogin")==="ok"){

    document.getElementById("loginScreen").style.display="none";

    document.getElementById("mainApp").style.display="block";

  }

});


</script>

</body>

</div>

</html>
